(()=>{class t{constructor(){this.ctas=document.querySelectorAll(".wacapi-btn"),this.capiurl="https://wacapi.com/wp-json/wacapi/v1/web-events",this.code=Math.random().toString(36).substring(7),setTimeout((()=>{this.init()}),2e3)}init(){this.ctas&&(this.getCookie("_wacapi_code")||(this.setCookie("_wacapi_code"),this.prepareEvent()),this.ctas.forEach((t=>{const e=this.getCookie("_wacapi_code")||this.code,o=t.href.replace("{{CODE}}",`[${e}]`);t.href=o})))}prepareEvent(){this.sendEvent()}sendEvent(){const t={url:window.location.href,user_agent:navigator.userAgent?navigator.userAgent:null,code:this.getCookie("_wacapi_code")||this.code,timestamp:(new Date).toISOString(),cookie:document.cookie},e=new URL(this.capiurl);fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((t=>{t.ok||409===t.status&&(this.code=Math.random().toString(36).substring(7),setTimeout((()=>{this.init()}),1e3))})).catch((t=>{console.error("Error sending event to Wacapi",t)}))}getCookie(t){const e=`; ${document.cookie}`.split(`; ${t}=`);if(2===e.length)return e.pop().split(";").shift()}setCookie(t){const e=new Date;e.setTime(e.getTime()+2592e6),document.cookie=`${t}=${this.code}; expires=${e.toUTCString()}; path=/`}}document.addEventListener("DOMContentLoaded",(()=>{new t}))})();
