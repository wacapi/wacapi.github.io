(()=>{class e{constructor(){this.ctas=document.querySelectorAll(".wacapi-btn"),this.capiurl="https://wacapi.com/wp-json/wacapi/v1/web-events",this.code=Math.random().toString(36).substring(7),this.init()}init(){this.ctas&&(this.getCookie("_wacapi_code")||(this.setCookie("_wacapi_code"),this.prepareEvent()),this.ctas.forEach((e=>{const t=this.getCookie("_wacapi_code")||this.code,o=e.href.replace("{{CODE}}",`[${t}]`);e.href=o})))}prepareEvent(){this.sendEvent()}sendEvent(){const e={url:window.location.href,user_agent:navigator.userAgent?navigator.userAgent:null,code:this.getCookie("_wacapi_code")||this.code,timestamp:(new Date).toISOString(),cookie:document.cookie},t=new URL(this.capiurl);fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>{e.ok||console.error("Error sending event to Wacapi",e)})).catch((e=>{console.error("Error sending event to Wacapi",e)}))}getCookie(e){const t=`; ${document.cookie}`.split(`; ${e}=`);if(2===t.length)return t.pop().split(";").shift()}setCookie(e){const t=new Date;t.setTime(t.getTime()+2592e6),document.cookie=`${e}=${this.code}; expires=${t.toUTCString()}; path=/`}}document.addEventListener("DOMContentLoaded",(()=>{new e}))})();
