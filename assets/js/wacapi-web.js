(()=>{class e{constructor(){this.ctas=document.querySelectorAll(".wacapi-btn"),this.capiurl="https://wacapi.com/web-events",this.code=Math.random().toString(36).substring(7),this.init()}init(){this.ctas&&(this.getCookie("_wacapi_code")||(this.setCookie("_wacapi_code"),this.prepareEvent()),this.ctas.forEach((e=>{const t=this.getCookie("_wacapi_code")||this.code;console.log(t);const o=e.href.replace("{{CODE}}",`[${t}]`);e.href=o})))}prepareEvent(){const e=this.getCookie("_fbp"),t=this.getCookie("_fbc");e&&t||this.sendEvent(),this.sendEvent(e,t)}sendEvent(e=null,t=null){const o={fbp:e,fbc:t,url:window.location.href,ua:navigator.userAgent?navigator.userAgent:null,code:this.getCookie("_wacapi_code")||this.code,timestamp:(new Date).toISOString(),cookie:document.cookie},i=new URL(this.capiurl);i.search=new URLSearchParams(o).toString(),fetch(i).then((e=>{e.ok||console.error("Error sending event to Wacapi",e)})).catch((e=>{console.error("Error sending event to Wacapi",e)}))}getCookie(e){const t=`; ${document.cookie}`.split(`; ${e}=`);if(2===t.length)return t.pop().split(";").shift()}setCookie(e){const t=new Date;t.setTime(t.getTime()+2592e6),document.cookie=`${e}=${this.code}; expires=${t.toUTCString()}; path=/`}}document.addEventListener("DOMContentLoaded",(()=>{new e}))})();
